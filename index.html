<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ProKanban Board</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./src/style.css" />
  </head>
  <body>
    <header>
      <h1>ProKanban</h1>
      <div class="header-actions">
        <button id="history-btn" class="btn-secondary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
            <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192l-2.36 1.966c-.12.1-.12.284 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
          </svg>
          History
        </button>
        <button id="clear-all-btn" class="btn-danger-outline">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
            <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a.5.5 0 0 1-1-0V3a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0-1h3A.5.5 0 0 1 11 2.5v.5h4a.5.5 0 0 1 .5.5z"/>
          </svg>
          Clear Board
        </button>
        <!-- EXPORT / IMPORT -->
        <button id="export-btn" class="btn-secondary" title="Export Board">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>
            Export
        </button>
        <button id="import-btn-trigger" class="btn-secondary" title="Import Board">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>
            Import
        </button>
        <input type="file" id="import-file" accept=".json" style="display: none;" />
        <button id="add-task-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
          </svg>
          New Task
        </button>
      </div>
    </header>

    <main>
      <div class="kanban-board">
        <!-- Todo Column -->
        <div class="column" data-status="todo" id="todo-col">
          <div class="column-header">
            <span>To Do</span>
            <span class="count">0</span>
          </div>
          <div class="tasks-container" id="todo-container">
            <!-- Tasks will vary here -->
          </div>
        </div>

        <!-- Progress Column -->
        <div class="column" data-status="progress" id="progress-col">
          <div class="column-header">
            <span>In Progress</span>
            <span class="count">0</span>
          </div>
          <div class="tasks-container" id="progress-container">
          </div>
        </div>

        <!-- On Hold Column -->
        <div class="column" data-status="on-hold" id="on-hold-col">
          <div class="column-header">
            <span>On Hold</span>
            <span class="count">0</span>
          </div>
          <div class="tasks-container" id="on-hold-container">
          </div>
        </div>

        <!-- Done Column -->
        <div class="column" data-status="done" id="done-col">
          <div class="column-header">
            <span>Done</span>
            <span class="count">0</span>
          </div>
          <div class="tasks-container" id="done-container">
          </div>
        </div>
      </div>
    </main>

    <!-- Add/Edit Task Modal -->
    <div class="modal" id="task-modal">
      <div class="modal-content">
        <h2 id="modal-title">Add New Task</h2>
        <form id="task-form">
          <input type="hidden" id="task-id" />
          <div class="form-group">
            <label for="task-desc">Task Description</label>
            <textarea id="task-desc" placeholder="What needs to be done?" required></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="task-priority">Priority</label>
              <select id="task-priority">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
              </select>
            </div>
            <div class="form-group">
              <label for="task-due-date">Due Date</label>
              <input type="date" id="task-due-date" />
            </div>
          </div>

          <div class="form-group">
             <label for="task-tags">Tags (comma separated)</label>
             <input type="text" id="task-tags" placeholder="dev, design, bug" />
          </div>
          <div class="modal-actions">
            <button type="button" class="btn-secondary" id="cancel-modal">Cancel</button>
            <button type="submit" class="btn-primary">Save Task</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Time Logs Modal -->
    <div class="modal" id="time-logs-modal">
      <div class="modal-content">
        <h2 id="logs-modal-title">Time Logs</h2>
        <div id="total-duration-container"></div>
        <div id="time-logs-list" class="time-logs-list">
          <!-- Logs will be injected here -->
        </div>
        <div class="modal-actions">
          <button type="button" class="btn-secondary" id="close-logs-btn">Close</button>
        </div>
      </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="history-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title-history">Activity Log</h2>
          <button id="close-history" class="btn-secondary" style="border:none; padding: 0.5rem;">
             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
             </svg>
          </button>
        </div>
        <div id="history-list" class="history-container">
           <!-- History items will be improved here -->
        </div>
        <button id="clear-history-btn" class="btn-danger-outline" style="margin-top: 1rem; width: 100%; justify-content: center;">
            Clear History
        </button>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <!-- Polyfill for Touch Drag and Drop -->
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <script type="module" src="./src/main.js"></script>
  </body>
</html>
